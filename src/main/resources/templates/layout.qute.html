<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{#insert title}DNS Filtering Service{/insert}</title>
    <link rel="stylesheet" href="/css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js"></script>
    <script>
        // Configure HTMX to include JWT token in all requests
        // This runs immediately, BEFORE any hx-trigger="load" elements are processed

        // Add JWT token to HTMX requests
        document.addEventListener('htmx:configRequest', function (event) {
            const token = sessionStorage.getItem('jwt_token');
            if (token) {
                event.detail.headers['Authorization'] = 'Bearer ' + token;
            }
        });

        // Handle 401 errors
        document.addEventListener('htmx:responseError', function (event) {
            if (event.detail.xhr.status === 401) {
                if (!window.location.pathname.includes('/login')) {
                    sessionStorage.setItem('redirect_after_login', window.location.pathname);
                    window.location.href = '/ui/login';
                }
            }
        });
    </script>
</head>
<body>
<header class="header">
    <div class="container header-content">
        <div class="logo">
            <h1>DNS<span>Shield</span></h1>
        </div>
        <nav class="nav-links">
            <a href="/ui" class="{#if active == 'dashboard'}active{/if}">Dashboard</a>
            <a href="/ui/filters" class="{#if active == 'filters'}active{/if}">Filter Rules</a>
            <a href="/ui/query" class="{#if active == 'query'}active{/if}">DNS Query</a>
            <a href="/ui/logs" class="{#if active == 'logs'}active{/if}">Query Logs</a>
            <a href="/ui/agent" class="{#if active == 'agent'}active{/if}">AI Agent</a>
            <a href="/ui/admin" class="{#if active == 'admin'}active{/if}">Admin</a>
            <a href="/ui/login" class="{#if active == 'login'}active{/if}" id="login-link">Login</a>
            <a href="#" onclick="logout(); return false;" id="logout-link" style="display: none;">Logout</a>
        </nav>
    </div>
</header>

<main>
    <div class="container">
        <div id="alerts-container"></div>
        {#insert content}{/insert}
    </div>
</main>

<footer>
    <div class="container">
        <p>DNS Filtering Service &copy; 2025 | Microservices Final Project</p>
    </div>
</footer>

<script src="/js/app.js"></script>
<script src="/js/dashboard-ws.js"></script>
{#insert scripts}{/insert}
</body>
</html>

