{#include layout.qute.html}
    {#title}Dashboard - DNS Filtering Service{/title}

    {#content}
        <h1 style="margin-bottom: 30px; color: var(--primary-color);">Dashboard</h1>

        <!-- Stats Cards -->
        <div class="dashboard-grid">
            <div class="card stat-card">
                <div class="stat-value" id="total-queries"
                     hx-get="/ui/logs/stats/total"
                     hx-trigger="load, every 30s"
                     hx-swap="innerHTML">
                    --
                </div>
                <div class="stat-label">Total DNS Queries</div>
            </div>

            <div class="card stat-card">
                <div class="stat-value" id="cache-hits"
                     hx-get="/ui/stats/cache-hits"
                     hx-trigger="load, every 30s"
                     hx-swap="innerHTML">
                    --
                </div>
                <div class="stat-label">Cache Hits</div>
            </div>

            <div class="card stat-card">
                <div class="stat-value" id="blocked-queries"
                     hx-get="/ui/logs/stats/blocked"
                     hx-trigger="load, every 30s"
                     hx-swap="innerHTML">
                    --
                </div>
                <div class="stat-label">Blocked Queries</div>
            </div>

            <div class="card stat-card">
                <div class="stat-value" id="threats-detected"
                     hx-get="/ui/logs/stats/threats"
                     hx-trigger="load, every 30s"
                     hx-swap="innerHTML">
                    --
                </div>
                <div class="stat-label">Threats Detected</div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="dashboard-grid">
            <!-- Recent Activity -->
            <div class="card">
                <div class="card-header">
                    <h2>üîç Quick DNS Lookup</h2>
                </div>
                <form onsubmit="testDNSQuery(event)">
                    <div class="form-group">
                        <label for="test-domain">Domain Name</label>
                        <input type="text" id="test-domain" class="form-control"
                               placeholder="example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="record-type">Record Type</label>
                        <select id="record-type" class="form-control">
                            <option value="A">A (IPv4)</option>
                            <option value="AAAA">AAAA (IPv6)</option>
                            <option value="MX">MX (Mail)</option>
                            <option value="TXT">TXT</option>
                            <option value="CNAME">CNAME</option>
                            <option value="NS">NS</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        Lookup
                    </button>
                </form>
                <div id="query-result" class="query-result"
                     style="margin-top: 20px; min-height: 100px;">
                    Enter a domain to lookup
                </div>
            </div>

            <!-- Cache Stats -->
            <div class="card">
                <div class="card-header">
                    <h2>üìä Cache Statistics</h2>
                    <button class="btn btn-sm btn-secondary" onclick="clearCache()">Clear Cache
                    </button>
                </div>
                <div id="cache-stats"
                     hx-get="/ui/stats/cache"
                     hx-trigger="load, every 30s"
                     hx-swap="innerHTML">
                    <div class="spinner"></div>
                    Loading...
                </div>
            </div>

            <!-- Security Overview -->
            <div class="card">
                <div class="card-header">
                    <h2>üõ°Ô∏è Security Overview</h2>
                </div>
                <div id="security-stats"
                     hx-get="/ui/stats/security"
                     hx-trigger="load, every 30s"
                     hx-swap="innerHTML">
                    <div class="spinner"></div>
                    Loading...
                </div>
            </div>

            <!-- Active Filter Rules Summary -->
            <div class="card">
                <div class="card-header">
                    <h2>üìã Active Filters</h2>
                    <a href="/ui/filters" class="btn btn-sm btn-primary">Manage</a>
                </div>
                <div id="filter-summary"
                     hx-get="/ui/stats/filters"
                     hx-trigger="load, every 60s"
                     hx-swap="innerHTML">
                    <div class="spinner"></div>
                    Loading...
                </div>
            </div>

            <!-- Fun Facts Section -->
            <div class="card fun-container">
                <div class="card-header">
                    <h2>üí° DNS Fun Facts</h2>
                    <button class="btn btn-sm btn-primary" onclick="displayRandomFact()">New Fact!
                    </button>
                </div>
                <div id="fun-fact"
                     style="min-height: 80px; font-style: italic; color: var(--text-secondary);">
                    Click "New Fact!" to learn something interesting about DNS!
                </div>
            </div>
        </div>

        <script>
            async function displayRandomFact() {
                const factDiv = document.getElementById('fun-fact');

                try {
                    // Check if the Prompt API is available
                    if (typeof LanguageModel === 'undefined') {
                        console.warn('Prompt API not available, falling back to hardcoded facts');
                        displayFallbackFact();
                        return;
                    }

                    // Show loading state
                    factDiv.innerHTML = 'ü§î Generating a fun DNS fact...';
                    factDiv.style.animation = 'pulse 1s infinite';

                    // Create a session with the Prompt API
                    const session = await LanguageModel.create({
                        initialPrompts: [{
                            role: "system",
                            content: "You are a helpful assistant that generates interesting, fun, and educational facts about DNS (Domain Name System), networking, and internet infrastructure. Keep facts concise (1-2 sentences), accurate, and engaging. Start each fact with a relevant emoji."
                        }],
                        expectedInputs: [
                            {type: "text", languages: ["en"]}
                        ],
                        expectedOutputs: [
                            {type: "text", languages: ["en"]}
                        ]
                    });

                    // Generate a DNS fact
                    const result = await session.prompt(
                        "Generate one interesting and fun fact about DNS, DNS security, DNS protocols, or internet infrastructure."
                    );

                    // Add animation and display the generated fact
                    factDiv.style.animation = 'none';
                    setTimeout(() => {
                        factDiv.style.animation = 'slideIn 0.5s ease-out';
                        factDiv.innerHTML = result;
                    }, 10);


                } catch (error) {
                    console.error('Error generating fact with Prompt API:', error);
                    displayFallbackFact();
                }
            }

            function displayFallbackFact() {
                // Fallback to hardcoded facts if Prompt API fails or is unavailable
                const facts = [
                    'üåê DNS requests happen billions of times per day! Without DNS, you\'d have to memorize IP addresses like 93.184.216.34 instead of typing example.com',
                    '‚ö° The first DNS query to a domain is usually the slowest - that\'s why DNS caching is so important!',
                    'üõ°Ô∏è DNS filtering can block malware, phishing, and ad networks before they even load!',
                    'üì° DNS uses UDP port 53 by default, but DNS-over-HTTPS (DoH) uses port 443 for privacy!',
                    'üîí DNSSEC adds cryptographic signatures to DNS records to prevent spoofing attacks!',
                    'üéØ Google\'s public DNS (8.8.8.8) processes over 400 billion queries per day!',
                    'üíæ DNS TTL (Time To Live) tells your computer how long to cache a DNS response!',
                    'üöÄ DNS queries typically complete in milliseconds - it\'s incredibly fast!',
                    'üåç There are 13 root nameservers managing all top-level domains globally!',
                    'üîÑ Reverse DNS lookups let you find domain names from IP addresses!'
                ];

                const fact = facts[Math.floor(Math.random() * facts.length)];
                const factDiv = document.getElementById('fun-fact');

                // Add animation
                factDiv.style.animation = 'none';
                setTimeout(() => {
                    factDiv.style.animation = 'slideIn 0.5s ease-out';
                    factDiv.innerHTML = fact;
                }, 10);
            }
        </script>
    {/content}

    {#scripts}{/scripts}
{/include}

